<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.dfjinxin.modules.price.dao.PssCommTotalDao">

    <!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="io.dfjinxin.modules.price.entity.PssCommTotalEntity" id="pssCommTotalMap">
        <result property="commId" column="comm_id"/>
        <result property="commName" column="comm_name"/>
        <result property="commAbb" column="comm_abb"/>
        <result property="parentCode" column="parent_code"/>
        <result property="levelCode" column="level_code"/>
        <result property="createTime" column="create_time"/>
        <result property="createName" column="create_name"/>
        <result property="dataFlag" column="data_flag"/>
    </resultMap>

    <select id="queryPageListCount" resultType="java.lang.Integer">
        select count(c2.comm_id)
        FROM pss_comm_total c2
        left join pss_comm_conf pcc on c2.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec
        on pcc.ewarn_id = pec.ewarn_id
        where pcc.del_flag=1 and pec.del_flag=1
        and c2.parent_code in (
        select comm_id
        from pss_comm_total c1
        where c1.parent_code in (
        select comm_id
        from pss_comm_total c0
        where 1=1
        <if test="param.commLevelCode_0 != null and param.commLevelCode_0 !=''">
            and c0.comm_id = #{param.commLevelCode_0} and c0.data_flag=0
        </if>
        )
        <if test="param.commLevelCode_1 != null and param.commLevelCode_1 !=''">
            and c1.comm_id=#{param.commLevelCode_1} and c1.data_flag=0
        </if>
        )
        <if test="param.commLevelCode_2 != null and param.commLevelCode_2 !=''">
            and c2.comm_id=#{param.commLevelCode_2} and c2.data_flag=0
        </if>
    </select>

    <select id="queryPageList" resultMap="pssCommTotalMap">
        SELECT c2.*,
        pcc.ewarn_id,
        pcc.remarks,
        pec.ewarn_id,
        pec.ewarn_name
        FROM pss_comm_total c2
        left join pss_comm_conf pcc on c2.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec on pcc.ewarn_id = pec.ewarn_id
        where pcc.del_flag=1 and pec.del_flag=1
        and c2.parent_code in (
        select comm_id
        from pss_comm_total c1
        where c1.parent_code in (
        select comm_id
        from pss_comm_total c0
        where 1=1
        <if test="param.commLevelCode_0 != null and param.commLevelCode_0 !=''">
            and c0.comm_id = #{param.commLevelCode_0} and c0.data_flag=0
        </if>
        )
        <if test="param.commLevelCode_1 != null and param.commLevelCode_1 !=''">
            and c1.comm_id=#{param.commLevelCode_1} and c1.data_flag=0
        </if>
        )
        <if test="param.commLevelCode_2 != null and param.commLevelCode_2 !=''">
            and c2.comm_id=#{param.commLevelCode_2} and c2.data_flag=0
        </if>
        LIMIT #{param.start}, #{param.pageSize}
    </select>

    <!-- 商品类型-0类 不为空，商品大类-1类 为空，查询指定0类-->
    <select id="queryPageListCountByLevelCode0" resultType="java.lang.Integer">
        select count(c0.comm_id)
        FROM pss_comm_total c0
        left join pss_comm_conf pcc on c0.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec
        on pcc.ewarn_id = pec.ewarn_id
        where  pcc.del_flag=1 and pec.del_flag=1
        and c0.parent_code in
        (
            select comm_id from pss_comm_total temp
            where temp.parent_code =#{param.commLevelCode_0}
            and temp.data_flag=0
        )
        and c0.data_flag=0
    </select>

    <select id="queryPageLisByLevelCode0" resultMap="pssCommTotalMap">
        SELECT c0.*,
        pcc.ewarn_id,
        pcc.remarks,
        pec.ewarn_id,
        pec.ewarn_name
        FROM pss_comm_total c0
        left join pss_comm_conf pcc on c0.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec
        on pcc.ewarn_id = pec.ewarn_id
        where  pcc.del_flag=1 and pec.del_flag=1
        and c0.parent_code in
        (
            select comm_id from pss_comm_total temp
            where temp.parent_code =#{param.commLevelCode_0}
            and temp.data_flag=0
        )
        and c0.data_flag=0
        LIMIT #{param.start}, #{param.pageSize}
    </select>

    <!-- 商品类型-0类 不为空，商品大类-1类 不为空，查询指定1类-->
    <select id="queryPageListCountByLevelCode1" resultType="java.lang.Integer">
        select count(c2.comm_id)
        FROM pss_comm_total c2
        left join pss_comm_conf pcc on c2.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec
        on pcc.ewarn_id = pec.ewarn_id
        where pcc.del_flag=1 and pec.del_flag=1
        and c2.parent_code in (
            select c1.comm_id
            from pss_comm_total c1
            where c1.parent_code in (
                select comm_id
                from pss_comm_total c0
                where c0.comm_id = #{param.commLevelCode_0}
            )and c1.comm_id = #{param.commLevelCode_1}
        )
    </select>

    <select id="queryPageLisByLevelCode1" resultMap="pssCommTotalMap">
        SELECT c2.*,
        pcc.ewarn_id,
        pcc.remarks,
        pec.ewarn_id,
        pec.ewarn_name
        FROM pss_comm_total c2
        left join pss_comm_conf pcc on c2.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec
        on pcc.ewarn_id = pec.ewarn_id
        where  pcc.del_flag=1 and pec.del_flag=1
        and c2.parent_code in (
            select c1.comm_id
            from pss_comm_total c1
            where c1.parent_code in (
                select comm_id
                from pss_comm_total c0
                where c0.comm_id = #{param.commLevelCode_0}
            )and c1.comm_id = #{param.commLevelCode_1}
        )
    </select>

    <select id="queryPageListCountByLevelCode2" resultType="java.lang.Integer">
        select count(c2.comm_id)
        FROM pss_comm_total c2
        left join pss_comm_conf pcc on c2.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec
        on pcc.ewarn_id = pec.ewarn_id
        where pcc.del_flag=1 and pec.del_flag=1
        and c2.parent_code in (
        select comm_id
        from pss_comm_total c1
        where c1.parent_code in (
        select comm_id
        from pss_comm_total c0
        where 1=1
        <if test="param.commLevelCode_0 != null and param.commLevelCode_0 !=''">
            and c0.comm_id = #{param.commLevelCode_0} and c0.data_flag=0
        </if>
        )
        <if test="param.commLevelCode_1 != null and param.commLevelCode_1 !=''">
            and c1.comm_id=#{param.commLevelCode_1} and c1.data_flag=0
        </if>
        )
        <if test="param.commLevelCode_2 != null and param.commLevelCode_2 !=''">
            and c2.comm_id=#{param.commLevelCode_2} and c2.data_flag=0
        </if>
    </select>

    <!-- 商品类型-0类 不为空，商品大类-1类 不为空，商品名称-2类 不为空 查询指定2类-->
    <select id="queryPageLisByLevelCode2" resultMap="pssCommTotalMap">
        SELECT c2.*,
        pcc.ewarn_id,
        pcc.remarks,
        pec.ewarn_id,
        pec.ewarn_name
        FROM pss_comm_total c2
        left join pss_comm_conf pcc on c2.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec on pcc.ewarn_id = pec.ewarn_id
        where pcc.del_flag=1 and pec.del_flag=1
        and c2.parent_code in (
        select comm_id
        from pss_comm_total c1
        where c1.parent_code in (
        select comm_id
        from pss_comm_total c0
        where 1=1
        <if test="param.commLevelCode_0 != null and param.commLevelCode_0 !=''">
            and c0.comm_id = #{param.commLevelCode_0} and c0.data_flag=0
        </if>
        )
        <if test="param.commLevelCode_1 != null and param.commLevelCode_1 !=''">
            and c1.comm_id=#{param.commLevelCode_1} and c1.data_flag=0
        </if>
        )
        <if test="param.commLevelCode_2 != null and param.commLevelCode_2 !=''">
            and c2.comm_id=#{param.commLevelCode_2} and c2.data_flag=0
        </if>
        LIMIT #{param.start}, #{param.pageSize}
    </select>

    <select id="selectSubCommByLevelCode2" resultMap="pssCommTotalMap">
        SELECT c2.*,
        pcc.ewarn_id,
        pcc.remarks,
        pec.ewarn_id,
        pec.ewarn_name
        FROM pss_comm_total c2
        left join pss_comm_conf pcc on c2.comm_id=pcc.comm_id
        left join pss_ewarn_conf pec on pcc.ewarn_id = pec.ewarn_id
        where pcc.del_flag=1 and pec.del_flag=1
        and c2.parent_code = #{parentCode}
        and c2.data_flag=0
        LIMIT #{param.start}, #{param.pageSize}
    </select>


</mapper>
